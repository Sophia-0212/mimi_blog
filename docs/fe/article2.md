# 二.浏览器工作流程-渲染
## 1.说一说从输入URL到页面呈现发生了什么？

> 这个题可以说是面试最常见也是一道可以无限难的题了，一般面试官出这道题就是为了考察你的前端知识深度。

1. URL解析：浏览器首先会解析输入的URL，提取出协议（如HTTP、HTTPS）、域名（如www.example.com）和路径等信息。

2. DNS解析：浏览器会向本地DNS解析器发送一个DNS查询请求，以获取输入域名对应的IP地址。如果本地DNS缓存中存在域名的解析结果，则直接返回IP地址；否则，本地DNS解析器会向**根DNS服务器**、**顶级域名服务器**和**授权域名服务器**等级联查询，最终获取到域名的IP地址。

3. 建立TCP连接：浏览器使用获取到的IP地址，通过TCP/IP协议与服务器建立网络连接。这个过程通常经历**三次握手**，确保客户端和服务器之间的可靠连接。

4. 发起HTTP请求：一旦建立了TCP连接，浏览器就会发送一个HTTP请求到服务器。请求中包含了**请求行**（请求方法，如GET或POST，以及请求的资源路径）、**请求头**（如Accept、User-Agent等）和**请求体**（对于POST请求）等信息。

5. 服务器处理请求：服务器接收到浏览器发送的HTTP请求后，会根据请求的路径和参数等信息，处理请求并生成相应的响应。

6. 接收响应：浏览器接收到服务器发送的HTTP响应后，会解析**响应头**和**响应体**。响应头包含了状态码（如200表示成功，404表示资源未找到）和其他元信息，响应体包含了服务器返回的实际内容（如HTML、CSS、JavaScript、图片等）。

7. 渲染页面：浏览器开始解析响应体中的HTML文档，并构建DOM（文档对象模型）树。同时，它还会解析CSS文件和JavaScript代码，并进行样式计算、布局和渲染。最终，将解析后的内容显示在用户界面上，呈现出完整的页面。

8. 关闭TCP连接（**四次挥手**）：一旦页面呈现完成，浏览器会关闭与服务器之间的TCP连接。如果页面中存在其他资源（如图片、脚本、样式表），则会继续发送相应的HTTP请求来获取这些资源，并重复执行步骤5到步骤7，直至所有资源加载完成。

### a.状态码：

以下是一些常见的HTTP状态码：

**1xx（信息性状态码）：表示接收的请求正在处理。**
- 100 Continue：服务器已接收到请求的初始部分，并要求客户端继续发送其余部分。
- 101 Switching Protocols：服务器已理解客户端的请求，并将切换到不同的协议进行处理。

**2xx（成功状态码）：表示请求已成功被服务器接收、理解和处理。**
- 200 OK：请求成功，服务器返回所请求的数据。
- 201 Created：请求已成功，并在服务器上创建了新的资源。
- 204 No Content：请求成功，但服务器没有返回任何内容。

**3xx（重定向状态码）：表示需要进一步操作以完成请求。**
- 301 Moved Permanently：请求的资源已永久移动到新位置。
- 302 Found：请求的资源暂时移动到新位置。
- 304 Not Modified：资源未被修改，客户端可以使用缓存的版本。

**4xx（客户端错误状态码）：表示客户端发出的请求有错误。**
- 400 Bad Request：服务器无法理解客户端的请求。
- 401 Unauthorized：请求需要用户身份验证。
- 404 Not Found：请求的资源不存在。

**5xx（服务器错误状态码）：表示服务器在处理请求时发生了错误。**
- 500 Internal Server Error：服务器遇到了意外错误，无法完成请求。
- 503 Service Unavailable：服务器暂时无法处理请求，通常是由于过载或维护。

### b.三次握手四次挥手
[三次握手四次挥手](https://javaguide.cn/cs-basics/network/tcp-connection-and-disconnection.html#%E5%BB%BA%E7%AB%8B%E8%BF%9E%E6%8E%A5-tcp-%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B)

## 2.浏览器重绘域重排的区别？

- 重排(reflow也被称**回流**)： 布局改变，重排成本高
- 重绘 (Repaint)： 样式改变，布局没变

> 重绘不一定导致重排，但重排一定绘导致重绘


**如何触发重绘和重排？**
任何改变 用来构建渲染树的信息 都会导致一次重排或重绘：
- 添加、删除、更新DOM节点
- 通过display: none隐藏一个DOM节点-触发重排和重绘
- 通过visibility: hidden隐藏一个DOM节点-只触发重绘，因为没有几何变化

**如何避免重绘或重排？**
- 集中改变样式：
	- 比如使用class的方式来集中改变样式
	- 使用document.createDocumentFragment()：我们可以通过createDocumentFragment创建一个游离于DOM树之外的节点，然后在此节点上批量操作，最后插入DOM树中，因此只触发一次重排
- 提升为合成层
	- 使用 CSS 的 **will-change 属性**将元素提升为**合成层**。有以下优点：交由 **GPU 合成，比 CPU 处理要快**
	- 使用 CSS3 的 transform 和 opacity 属性来进行动画效果，它们可以利用 GPU 加速，减少重排的发生。


## 3.CSS加载会阻塞DOM吗？
**先上结论：**

> - CSS不会阻塞DOM的解析，但会阻塞DOM的渲染
> - CSS会阻塞JS执行，但不会阻塞JS文件的下载


为什么CSS不会阻塞DOM的解析，但会阻塞DOM的渲染？（**DOM和CSSOM通常是并行构建的，所以CSS加载不会阻塞DOM的解析，前一个DOM的解析指的是HTML的解析构建DOM树，后一个DOM的渲染指的是DOM与CSSOM结合的渲染树的渲染**）

CSS解析之前，由HTML解析出来的DOM已经开始构建？（**并行的，但是，如果dom解析到一半，遇到js改变css样式则需要等待css被加载完毕，这也是为什么css会阻塞JS的执行**）

1. **DOM 构建**: 当浏览器开始接收到HTML内容时，它会开始构建DOM（Document Object Model）。DOM是一个树形结构，表示页面的内容结构。DOM的构建是逐步的，也就是说，**当浏览器接收到HTML内容的一部分时，它就开始构建DOM的这一部分。**

2. **CSSOM 构建**: 同时，当浏览器遇到外部CSS文件（通过`<link>`标签）或内部样式（通过`<style>`标签）时，它开始构建另一个树结构，称为CSSOM（CSS Object Model）。CSSOM表示样式规则及其如何应用到DOM上。

3. **渲染树 构建**: 一旦浏览器有了DO**M和CSSOM，它会结合这两者来创建渲染树。渲染树只包含在页面上可见的元素**以及这些元素的样式。

4. **布局**: 当渲染树被创建并完成之后，浏览器开始了布局过程，也被称为"reflow"。这是计算每个可见元素的大小和位置的过程。

5. **绘制**: 经过布局之后，浏览器会开始绘制页面，将每个元素渲染到屏幕上。

但是，一个重要的点要注意：当浏览器在构建DOM时遇到`<script>`标签，并且该脚本不是`async`或`defer`的，浏览器会暂停DOM的构建，直到脚本执行完毕。如果此时的JavaScript试图访问某些尚未解析的CSS属性，那么浏览器可能需要先完成CSSOM的构建。这就是为什么阻塞的（非异步的）JavaScript和大量的CSS可能会导致页面加载延迟的原因之一。

## 4.JS会阻塞页面吗？

### a.deffer\async 加载js
[deffer\async 加载js](https://blog.csdn.net/weixin_43850639/article/details/129342084)
**先上结论**
> JS会阻塞DOM的解析，也会与渲染线程互斥，因此也就会阻塞页面的加载

这也是为什么要把JS文件放在最下面的原因

**为什么GUI渲染线程要和JS引擎互斥？**

由于 JavaScript 是可操纵 DOM 的,如果在修改这些元素属性同时渲染界面（即 JavaScript 线程和 UI 线程同时运行）,那么**渲染线程前后获得的元素数据就可能不一致了**。

因此为了防止渲染出现不可预期的结果,浏览器设置 「**GUI 渲染线程与 JavaScript 引擎为互斥**」的关系。

当浏览器在执行 JavaScript 程序的时候,GUI 渲染线程会被保存在一个队列中,直到 JS 程序执行完成,才会接着执行。

因此如果 JS 执行的时间过长,这样就会造成页面的渲染不连贯,导致页面渲染加载阻塞的感觉。


## 5.浏览器的事件循环是什么？macro-task 和 micro-task 有什么不同？
[JS事件循环机制](https://blog.csdn.net/weixin_43850639/article/details/129652054)
